{% extends "base.html" %}

{% block title %}{{ service.name }} - SHOP&SERV{% endblock %}

{% block content %}
<div class="container" style="padding: 2rem 20px;">
    <div class="product-detail-container">
        <div class="product-detail-image">
            {% if service.image %}
            <img src="{{ url_for('static', filename='uploads/' ~ service.image) }}" alt="{{ service.name }}">
            {% else %}
            <img src="https://via.placeholder.com/500x400?text=Service" alt="{{ service.name }}">
            {% endif %}
        </div>
        
        <div class="product-detail-info">
            <h1>{{ service.name }}</h1>
            
            {% if service.category %}
            <span class="badge" style="margin-bottom: 1rem;">{{ service.category }}</span>
            {% endif %}
            
            <div class="product-price" style="font-size: 2rem; margin: 1rem 0;">
                {{ service.price|format_currency }}
            </div>
            
            {% if service.duration %}
            <p style="color: var(--gray); margin: 0.5rem 0;">
                <strong>‚è±Ô∏è Duration:</strong> {{ service.duration }}
            </p>
            {% endif %}
            
            <p style="color: var(--gray); margin: 0.5rem 0;">
                <strong>üè™ Provider:</strong> {{ service.shop.name }}
            </p>
            
            <div class="provider-contact" style="background: var(--light-gray); padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0;">
                <h4 style="margin: 0 0 1rem 0; color: var(--primary);">üìû Contact Provider</h4>
                
                {% if service.shop.contact_phone %}
                <p style="margin: 0.5rem 0;">
                    <strong>üì± Phone:</strong> 
                    <a href="tel:{{ service.shop.contact_phone }}" style="color: var(--primary); text-decoration: none;">
                        {{ service.shop.contact_phone }}
                    </a>
                </p>
                {% endif %}
                
                {% if service.shop.contact_whatsapp %}
                <p style="margin: 0.5rem 0;">
                    <strong>üí¨ WhatsApp:</strong> 
                    <a href="https://wa.me/{{ service.shop.contact_whatsapp.replace('-', '').replace(' ', '') }}" 
                       target="_blank" style="color: #25D366; text-decoration: none;">
                        {{ service.shop.contact_whatsapp }}
                    </a>
                </p>
                {% endif %}
                
                {% if service.shop.contact_email %}
                <p style="margin: 0.5rem 0;">
                    <strong>üìß Email:</strong> 
                    <a href="mailto:{{ service.shop.contact_email }}" style="color: var(--primary); text-decoration: none;">
                        {{ service.shop.contact_email }}
                    </a>
                </p>
                {% endif %}
                
                {% if service.shop.address %}
                <p style="margin: 0.5rem 0;">
                    <strong>üìç Address:</strong> {{ service.shop.address }}
                    {% if service.shop.city %}, {{ service.shop.city }}{% endif %}
                    {% if service.shop.state %}, {{ service.shop.state }}{% endif %}
                    {% if service.shop.pincode %} - {{ service.shop.pincode }}{% endif %}
                </p>
                {% endif %}
                
                {% if service.shop.opening_time and service.shop.closing_time %}
                <p style="margin: 0.5rem 0;">
                    <strong>üïê Hours:</strong> {{ service.shop.opening_time.strftime('%I:%M %p') }} - {{ service.shop.closing_time.strftime('%I:%M %p') }}
                </p>
                {% endif %}
            </div>
            
            <div class="product-description" style="margin: 2rem 0;">
                <h3>About this Service</h3>
                <p>{{ service.description }}</p>
            </div>
            
            {% if current_user.is_authenticated and current_user.role == 'customer' %}
            <button onclick="addServiceToCart({{ service.id }})" class="btn btn-primary btn-lg" style="width: 100%;">
                Add to Cart
            </button>
            {% else %}
            <a href="{{ url_for('login') }}" class="btn btn-primary btn-lg" style="width: 100%;">
                Login to Book
            </a>
            {% endif %}
            
            <a href="{{ url_for('services') }}" class="btn btn-secondary" style="width: 100%; margin-top: 1rem;">
                ‚Üê Back to Services
            </a>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    async function addServiceToCart(serviceId) {
        try {
            const response = await fetch(`/cart/add-service/${serviceId}`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'X-CSRFToken': getCSRFToken()
                }
            });
            
            const data = await response.json();
            
            if (data.success) {
                alert('Service added to cart!');
                updateCartCount(data.cart_count);
            } else {
                alert('Error: ' + data.message);
            }
        } catch (error) {
            alert('An error occurred. Please try again.');
            console.error(error);
        }
    }
    
    function updateCartCount(count) {
        const cartBadge = document.querySelector('.cart-badge');
        if (cartBadge) {
            cartBadge.textContent = count;
            cartBadge.style.display = count > 0 ? 'block' : 'none';
        }
    }
</script>
{% endblock %}
